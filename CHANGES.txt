✅ РЕАЛИЗОВАНО (29 января 2026)

════════════════════════════════════════════════════════════════
1. КОРОТКИЕ ССЫЛКИ ДЛЯ ТОВАРОВ
════════════════════════════════════════════════════════════════

При клике "Ссылка" на товар копируется КОРОТКАЯ ссылка:
  ❌ Было: https://wite-hik.ru/uploads/cloud/2901262/products/1_2901262.png
  ✅ Стало: https://wite-hik.ru/img/ABC12345

Изменения в коде:
  • js/components/CloudSaver.js - функция handleCopyLink() теперь проверяет 
    есть ли short_url и копирует его вместо полной ссылки
  • js/components/Gallery.js - добавлена логика выбора короткой ссылки
  • api.php - система коротких ссылок была добавлена в предыдущем обновлении

════════════════════════════════════════════════════════════════
2. ОПТИМИЗАЦИЯ РАЗМЕРА ТОВАРОВ
════════════════════════════════════════════════════════════════

При загрузке товара (category='products'):
  ✓ PNG автоматически конвертируется в JPG (качество 82)
  ✓ Файлы больше 2MB сжимаются в JPG
  ✓ JPEG файлы оптимизируются (качество 82)
  ✓ Мокапы НЕ сжимаются (остаются как есть)

Примерное уменьшение размера:
  • PNG 5MB → JPG 400KB
  • PNG 2MB → JPG 150KB
  • JPEG большой → JPEG оптимизированный (обычно -30-40%)

Изменения в коде:
  • api.php добавлена функция compressProductImage()
  • api.php при загрузке товаров автоматически вызывается сжатие

════════════════════════════════════════════════════════════════
КАК ЭТО РАБОТАЕТ
════════════════════════════════════════════════════════════════

ТОВАР (products):
1. Загружаешь изображение
2. PHP проверяет: это товар?
3. Если PNG или >2MB → конвертирует в JPG качество 82
4. Создаёт превью для админки
5. Создаёт короткую ссылку /img/ABC12345
6. При клике "Ссылка" копируется /img/ABC12345

МОКАП (mockups):
1. Загружаешь изображение
2. PHP НЕ сжимает (сохраняет оригинальное качество)
3. Создаёт превью
4. SHORT_URL не создаётся
5. При клике "Ссылка" копируется полная ссылка

════════════════════════════════════════════════════════════════
ФАЙЛЫ ИЗМЕНЕНЫ
════════════════════════════════════════════════════════════════

✏️ api.php
   • Добавлена функция compressProductImage()
   • При загрузке товаров вызывается сжатие
   • Конвертация PNG → JPG
   • Оптимизация больших файлов

✏️ js/components/CloudSaver.js
   • Функция handleCopyLink() теперь использует short_url для товаров
   • Все вызовы handleCopyLink() передают объект файла

✏️ js/components/Gallery.js
   • При копировании ссылки проверяет: товар ли это?
   • Если товар с short_url → копирует /img/{ID}
   • Иначе копирует полную ссылку

════════════════════════════════════════════════════════════════
ТЕСТИРОВАНИЕ
════════════════════════════════════════════════════════════════

1. Загрузить PNG товар → должен превратиться в JPG
2. Загрузить большой JPEG товар → должен оптимизироваться
3. Нажать "Ссылка" на товар → должна скопироваться /img/ABC123
4. Нажать "Ссылка" на мокап → должна скопироваться /uploads/cloud/...
5. Открыть /img/ABC123 в браузере → редирект на товар ✓

════════════════════════════════════════════════════════════════
ПАРАМЕТРЫ КАЧЕСТВА
════════════════════════════════════════════════════════════════

Текущие настройки:
  • Качество JPG: 82 (из 100)
  • Порог сжатия: 2MB

Если нужно изменить:
  api.php строка ~515:
    compressProductImage($finalPath, $jpgPath, 82);  // 82 - качество
  
  api.php строка ~514:
    if (...$originalSize > 2097152) {  // 2097152 = 2MB в байтах

════════════════════════════════════════════════════════════════

✓ Всё готово к использованию!
